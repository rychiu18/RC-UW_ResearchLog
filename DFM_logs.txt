Log of DelftFM runs

02/08/24:
- Job 16450943 (TwinHarbors_test09):
  - Model run from 11/23/23 - 12/11/23
  - Tides, met, and discharge
    - Added new discharge.bc files for all discharge points
      - Did not include Satsop b/c further upstream than Montesano
      - Put in new .pli file for Naselle River
  - Started at 00:36, ended at

02/07/24:
- Job 16447890 (TwinHarbors_test08):
  - Changed run from 11/23/23 - 12/11/23
    - TStart = 1900800
    - TStop = 3542400
  - Only for tides to see results
  - Started at 21:59, ended at


02/06/24:
- Job 16411872 (TwinHarbors_test07)
  - Put back in MET forcing files (.amp, .amu, .amv)
  - Started 12:28, ended at 15:23 (failed after 02:55 of run time)
    - Mostly ran, except forcing file missing last hour of data

02/05/24:
- Job 16404103 (TwinHarbors_test07)
  - Starting on 12/01/23 for 7 days
  - Made tides ONLY to see if we still see weird water levels appear on hour 40
  - Started run at 23:50, ended at 02:45 on 02/06/24 (~<3 hours)
  - Water level data looks good! (except for weird artifact at north point of Willapa Bay)
- Job 16397467 (TwinHarbors_test06)
  - 4 day run starting on 11/15/23
  - Running with only tides to compare with tides and met forcing to see if water level anomalies still show after 40 hours
  - Using Yingzhong's new test.slurm and submit_singularity.sh configurations
  - Removed atmospheric forcing from the FlowFM_test.ext file
  - Started at 15:54, ended at 23:38 (~7:45 runtime) - 56 hours of data
- Job 16391479 (TwinHarbors_test07)
  - Created TwinHarbors_test07 to run 7 days (12/01-12/07/23) for storm and test to see if jump in water level is observed after ~46 hours
  - Changed test.slurm back to mem=200G, and time=72:00:00
  - Wrote new .amp, .amu, and .amv files for 7 days of forcing
  - Yingzhong helped debug "no FlowFM_000*.mdu" files found
    - Fixed by removing 0 from "CrsFile = " line in FlowFM.mdu file
    - Also had to change the ncep file extention from .amp to .amu in the .ext file (put .amp for u-wind by accident)
  - Ran to make sure it worked, then cancelled


02/05/24:
- Job 16385874 (TwinHarbors_test06)
  - Rewrote analysis script to plotDFMAtm_v2.py and verified it worked for all data (waterdepth at least)
  - Put back atmospheric forcing to model
  - Had to change partition to compute (instead of compute-bigmem)
    - Also had to change SBATCH --time=48:00:00 to keep within time limit (old was 72:00:00)
    - Changed mem=200G to mem=100G (this made it work on compute partition!)
  - Started 00:06 and ended 09:11
02/04/24:
- Job 16385359 (TwinHarbors_test06)
  - Changed .mdu files RefDate to 20231101 (before it was referenced to 20231115)
    - This means changing the TStart and TStop referenced to 20231101 (before it was referenced to 20231115)
      - TStart = 1209600
      - TStop = 1555200
    - Also changing HisInterval and MapInterval to reference to 20231101
      - HisInterval                       = 3600 1209600 1555200
      - MapInterval                       = 3600 1209600 1555200
  - Started at 21:44, cancelled at 22:13 (model run time of 28 minutes)
  - Worked showing reliable water depth using plotDFMAtm_v2.py!
- Job 16383865 (TwinHarbors_test06)
  - Made ONLY tides (turned off MET forcing to see if it causes the weird data)
    - Removed MET forcing in "FlowFM_test.ext" file
  - Started at 18:27, cancelled at 18:35, 8 minute runtime
  - Still weird data
- Job 16379406 (TwinHarbors_test06)
  - Rewrote met forcing and verified output was correct (MakeAtmGrid_v6.py)
  - Ran model again for 4 days to see if wind output is still psychedelic
  - Started at 01:41:00 and stopped at 01:05:00 (~12 hour run resulted in 54 hours of data)

02/01/24:
- Job 16352608 (TwinHarbors_test06)
  - Switched .dimr file back to exclude waves
  - Ran but cancelled after 9 hours 48 minutes (Got 50 hours of data - 2 days and 2 hours)
  - Still has that spike right after 40 hours
  - Wind field looks weird

- Job 16352586 (TwinHarbors_test06)
  - Placed back FlowFM_000*.mdu and .cache files
  - Placed back tw_v60m_1999_000*_net.nc files
  - If the .cache, .mdu, and _net.nc files aren't in, model won't run!
  - Changed the .dimr file back to include WAVES
  - Did not work when running wave portion (even though it's switched off in .mdu file

- Job 16352462 (TwinHarbors_test06)
  - Changed back to old submit_singularity.sh and test.slurm
  - Could not find FlowFM_000*.mdu files!
- Job 16351860 (TwinHarbors_test06)
  - Added newer test.slurm and submit_singularity.sh file (from Yingzhong)
    - test.slurm (changed nodes, ntasks-per-node, time, 'OMP_NUM_THREADS_SWAN=4')
    - submit_singularity.sh (changed to nNodes=1, nProc=16)
    - Deleted FlowFM_000*.mdu, FlowFM_000*.cache, tw_v60m_1999_000*_net.nc files (should work without)
    - Recreated interpolation over new meshgrid for .amp, .amu, and .amv files for dx=0.1, dy=0.1
      - Changed ncol and nrow to 83x83
      - Changed lower left center x,y start coordinate to minimum on interpolated grid
    - Changed time to run for 4 days (345600 seconds) still starting from 11-15-2023 in .mdu file
  - Ran with submit_singularity_new.sh and test_new.slurm from Yingzhong (but did not work)
    - "Error opening file FlowFM_0013.mdu"
    

01/29/24:
- Job 16288886 (TwinHarbors_test06)
  - Model for full MET (110123-121123) and tide data
  - Created .amp, .amu, and .amv files with matrix for entire time period
  - Changed .mdu files to correct time (27 day run)
  - Added back boundary forcing for tides
  - Changed MET forcing files in .ext file

01/28/24:
- Job 16283562 (TwinHarbors_test05)
  - Run for only 6 hours of time starting from 12012023 with only MET data
  - Rewrote .amp, .amu, .amv files
    - Changed to x_llcenter, y_llcenter
    - Resized to 52x71 dimensions based on interpolation
    - Wrote output to start from upper left corner

01/17/24:
- Job 16136872 (TwinHarbors_test05)
  - Added 2 spaces between each value and 2 spaces before the start of each array in the ncep_20231201.amp file (matching the ncep_1999 files)
  - Added 6 spaces between each value and 6 spaces before the start of each array in the ncep_20231201.amu/amv files (matching the ncep_1999 files)
  - Still only 51 grid points after running!
- Job 16135777 (TwinHarbors_test05)
  - Change grid_unit to ‘degree’ instead of ‘degrees’
  - Add space before first line for output files (u,v,p)
  - Only write to 3 floats for pressure and wind
  - Still only 51 grid points after running!

01/16/24:
- Job 16130670 (TwinHarbors_test05)
  - Changed amp, amu, and amv dx and dy to degrees instead of 12km
  - Still same, only had 51 grid points that were off
- Job 16127385 (TwinHarbors_test05)
  - Run only includes wind and pressure forcing
  - Changed to run for only 6 hours (21600 seconds)
    - Starting from 12-01-23
    -   TStart = 0
    -   TStop = 21600
  - Created new u, v, and pressure files (ncep_20231201_to_20231202)
    - Start lower left center at [43.0348848, -130.05956692]
    - ∆x = 12km; ∆y = 12km
  - Updated external forcing files to only contain amu, amv, and amp
    - For TIME = n hours since 12-01-23 00:00, remember to put in n+1 hours for forcing
  - Added FlowFM_00* and tw_v60_1999_00* files from TwinHarbors_test03 to file
    - Changed the start reference date and TStart and TStop in each file
  - Completed run in ~3 minutes!
    - Only created 51 grid points of uwind, vwind, and pressure data

01/10/24:
- (TwinHarbors_test04) - never completed, come back to it later on
  - Changed the filepaths to record output to dflow/output/
  - Used MakeDischarge.py file from local to create:
    - 'willapa_discharge.bc'
    - 'wynoochee_discharge.bc'
    - 'chehalis_discharge.bc'
    - 'columbia_discharge.bc'
    - Need to do Naselle, and Satsop
    - Need to make transects for discharge locations for Naselle and Satsop
    - Change FlowFM_bnd_test.ext to include discharges
    - Need to fill in atm files (amp, amu, amv) and add back into FlowFM_test.ext


01/04/24:
- Job 15966402 (TwinHarbors_test04)
  - Removed FlowFM_0* files (cache and mdu) and tw_v60m_1999_0*.net.nc files
  - Ran from TwinHarbors_test04 but saved in TwinHarbors_test03
  - Worked! Took 20 hours to complete

01/04/24:
- Job 15952640 (TwinHarbors_test03)
  - added tides back into external forcing file
  - Changed filename of Discharge.bc to Discharge_orig.bc
    - Emptied contents of Dicharge.bc
  - Took 19 hours
  - Only had one .his file for water level and winds (FlowFM_0000.his), other FlowFM_0001 and up did not have any .his files

12/28/23:
- Job 15836826(TwinHarbors_test03)
  - test.slurm
    - #SBATCH --chdir=/mmfs1/gscratch/derakhti/shared/rchiu18/TwinHarbors_test03 (line 19)
  - submit_singularity.sh
    - cd /mmfs1/gscratch/derakhti/shared/rchiu18/TwinHarbors_test03/dflowfm (line 99)
    - cd /mmfs1/gscratch/derakhti/shared/rchiu/TwinHarbors_test03 (line 105)
  - Created FlowFM_bnd_test.ext with nothing to use in FlowFM.mdu
  - Created FlowFM_test.ext with nothing to use in FlowFM.mdu
  - FlowFM.mdu
    - RefDate = 20231101             # Reference date [YYYY-MM-DD HH:MM:SS] (line 141)
    - TStart = 1296000              # Start time w.r.t. RefDate (in TUnit) (line 148)
    - TStop = 3628800              # Stop  time w.r.t. RefDate (in TUnit)(line 149)
    - HisInterval = 3600 1296000 3628800 # History output times, given as 'interval' 'start period' 'end period' (line 184)
    - CrsFile = 0 # Polyline file *_crs.pli defining observation cross sections (line 182)
    - ExtForceFileNew = FlowFM_bnd_test.ext # New format for external forcings file *.ext, link with bc-format boundary conditions specification (line 157)
    - ExtForceFile = FlowFM_test.ext # Old format for external forcings file *.ext, link with tim/cmp-format boundary conditions specification (line 156)
  - dimr)config_parallel.xml
    - Removed waves and parallel brackets pertaining to waves
  - FlowFM_000*.mdu (8 total)
    - RefDate = 20231101 # Reference date [YYYY-MM-DD HH:MM:SS] (line 141)
    - TStart = 1296000 # Start time w.r.t. RefDate (in TUnit) (line 148)
    - TStop = 3628800 # Stop  time w.r.t. RefDate (in TUnit) (line 149)
    - ExtForceFile = FlowFM.ext # Old format for external forcings file *.ext, link with tim/cmp-format boundary conditions specification (line 156)
    - ExtForceFileNew = FlowFM_bnd.ext # New format for external forcings file *.ext, link with bc-format boundary conditions specification (line 157)
    - HisInterval = 3600 1296000 3628800 # History output times, given as 'interval' 'start period' 'end period' (line 184)
    - MapInterval = 3600 1296000 2160000 # Map file output times, given as 'interval' 'start period' 'end period' (line 187) 
  - Took 10 minutes to complete
  - Did not work, forgot to put in tides in the external forcing file!

12/18/23:
- Job 15752705 (TwinHarbors_test02)
  - dimr_config_parallel.xml
    - Removed </time> and moved <start name="DflowFM"/> outside to control
  - ~9 hours for fun
- Job 15752666 (TwinHarbors_test02)
  - Recopied *.pli files b/c it contained transect locations
  - FAILED
    - Might have to do something with allocation of nodes/proc
- Job 15752640 (TwinHarbors_test02)
  - Discharge.bc
    - Added for discharge values
      1036800  0
      2332800  0
  - FAILED
- Job 15751378 (TwinHarbors_test02)
  - dimr_config_parallel.xml 
    - Removed "<start name="Waves"/>" (Line 36)
    - Removed 49-52: </component>....<component name="Waves">
  - FAILED:
      =   BAD TERMINATION OF ONE OF YOUR APPLICATION PROCESSES
      =   RANK 0 PID 88273 RUNNING AT n3008
      =   KILLED BY SIGNAL: 9 (Killed)
  - Maybe .dimr file?
- Job 15749723 (TwinHarbors_test02)
  - All *.pli's
    - Added 0's and "0001, 0002, 0003, etc" to end of line
  - FAILED
- Job 15749720 (TwinHarbors_test02)
  - Changed for TwinHarbors_test02
    -  test.slurm
      - Changed line 23 to:
        - #SBATCH --chdir=/mmfs1/gscratch/derakhti/shared/rchiu18/TwinHarbors_test02
    -  submit_singularity.sh
      - Changed line 99 to:
        - cd /mmfs1/gscratch/derakhti/shared/rchiu18/TwinHarbors_test02/dflowfm
      - Changed line 68 to:
        - cd /mmfs1/gscratch/derakhti/shared/rchiu18/TwinHarbors_test02
    - FlowFM.mdu
      - Changed line 135 to:
        - Wavemodelnr  = 0
    - Discharge.bc
      -  Removed Q from each river
    - All *.pli
      - Removed Q data
    - ncep*.amp, .amv, amu
      - n_cols = 0 (before 32)
      - n_rows = 0 (before 32)
  - FAILED 

11/27/23:
- Job 15466558
  - Changed “FlowFM.mdu”
    - Old
      - Tend = 1209600 
    - New (changed to 14 days)
      - Tend = 2246400
  - Changed “test.slurm”
    - Old
      - #SBATCH --time=24:00:00 
    - New (changed to 2 day max run time)
      - #SBATCH --time=48:00:00
  - Start test at 17:13pm on compute-bigmem partition
    - Job ID: 15466558
    - Uses 64 CPUs
- Job 15461143
  - Changed “FlowFM.mdu”
    - Old
      - Tend = 1054800 
    - New (changed to 48 hours)
      - Tend = 1209600
  - Changed “test.slurm”
    - Old
      - #SBATCH --time=1:00:00 
    - New
      - #SBATCH --time=24:00:00
  - Start test at 02:01pm on compute-bigmem partition
    - Job ID: 15461143
    - Uses 64 CPUs

11/25/23:
- Job 15448379
  - Changed “FlowFM.mdu”
    - Old
      - Tend = 2332800 
    - New (changed to 5 hours)
      - Tend = 1054800
  - Changed “test.slurm”
    - Old
      - #SBATCH --time=1:00:00 
    - New
      - #SBATCH --time=10:00:00
      - Added (email alert for test start and stop)
        - #SBATCH --mail-type=ALL
        - #SBATCH --mail-user=rchiu18
  - Start test at 16:22pm on compute-bigmem partition
    - Job ID: 15448379
    - Uses 64 CPUs

11/17/23:
- Job 15392871
  - Changed “dimr_config_parallel.xml”:
    - <time>0 3600 2592000</time> (old)
    - <time>0 3600 86400</time> (24 hr)
  - Changed “dimr_config_parallel_lib.xml”
    - <time>0 3600 2592000</time> (old)
    - <time>0 3600 86400</time> (24 hr)
  - There are some times in the FlowFM.mdu file and FlowFM_month.mdu but did not change them
  - Start test at 23:26 on compute-bigmem partition
    - Job ID: 15392871
  - Time limit exceeded based on slurm-15392871.out file
    - Need to change other times in “FlowFM.mdu” file
